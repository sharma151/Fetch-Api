<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe List with Search and Filters</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid black;
            text-align: left;
        }

        .filter-container {
            margin-top: 20px;
            display: none;
        }

        .filter-group {
            margin-bottom: 10px;
        }

        .search-container {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <h1>Recipe List</h1>

    <!-- Search Bar and Button -->
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Search recipes..." />
        <button id="filter-toggle">Show Filters</button>
    </div>

    <!-- Filter Section -->
    <div class="filter-container" id="filter-container">
        <div class="filter-group">
            <h3>Categories</h3>
            <div id="category-filters"></div>
        </div>
        <div class="filter-group">
            <h3>Areas</h3>
            <div id="area-filters"></div>
        </div>
        <div class="filter-group">
            <h3>Ingredients</h3>
            <div id="ingredient-filters"></div>
        </div>
        <button id="apply-filters">Apply Filters</button>
    </div>

    <!-- Hardcoded Table Structure -->
    <table id="recipe-table">
        <thead>
            <tr>
                <th>Recipe Name</th>
                <th>Category</th>
                <th>Area</th>
                <th>Ingredients</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be populated dynamically here -->
        </tbody>
    </table>

    <script>
        let allRecipes = []; // Store all fetched recipes
        let categories = [];
        let areas = [];
        let ingredients = [];

        // Debounce function: Ensures that search is performed after a delay
        function debounce(func, delay) {
            let debounceTimer;
            return function (...args) {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => func.apply(this, args), delay);
            };
        }

        // Fetch the data when the webpage is loaded
        document.addEventListener("DOMContentLoaded", function () {
            fetch('https://api.example.com/recipes') // Replace with your API
                .then(response => response.json())
                .then(data => {
                    allRecipes = data;
                    displayRecipes(allRecipes);
                    extractFilters(allRecipes); // Extract categories, areas, and ingredients
                    populateFilters();
                })
                .catch(error => console.error('Error fetching data:', error));
        });

        // Function to display recipes in the table
        function displayRecipes(recipes) {
            const tableBody = document.querySelector('#recipe-table tbody');
            tableBody.innerHTML = ''; // Clear previous table rows

            recipes.forEach(recipe => {
                const row = document.createElement('tr');
                row.innerHTML = `
          <td>${recipe.name}</td>
          <td>${recipe.category}</td>
          <td>${recipe.area}</td>
          <td>${recipe.ingredients.join(', ')}</td>
        `;
                tableBody.appendChild(row);
            });
        }

        // Extract unique categories, areas, and ingredients for filters
        function extractFilters(recipes) {
            const categorySet = new Set();
            const areaSet = new Set();
            const ingredientSet = new Set();

            recipes.forEach(recipe => {
                categorySet.add(recipe.category);
                areaSet.add(recipe.area);
                recipe.ingredients.forEach(ingredient => ingredientSet.add(ingredient));
            });

            categories = [...categorySet];
            areas = [...areaSet];
            ingredients = [...ingredientSet];
        }

        // Populate the filter checkboxes dynamically
        function populateFilters() {
            const categoryFilters = document.getElementById('category-filters');
            const areaFilters = document.getElementById('area-filters');
            const ingredientFilters = document.getElementById('ingredient-filters');

            // Populate category filters
            categories.forEach(category => {
                const checkbox = createCheckbox('category', category);
                categoryFilters.appendChild(checkbox);
            });

            // Populate area filters
            areas.forEach(area => {
                const checkbox = createCheckbox('area', area);
                areaFilters.appendChild(checkbox);
            });

            // Populate ingredient filters
            ingredients.forEach(ingredient => {
                const checkbox = createCheckbox('ingredient', ingredient);
                ingredientFilters.appendChild(checkbox);
            });
        }

        // Create checkbox input dynamically
        function createCheckbox(type, value) {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = type;
            checkbox.value = value;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(value));
            return label;
        }

        // Filter function to apply search and filters together
        function filterRecipes() {
            const searchQuery = document.getElementById('search-input').value.toLowerCase();

            const selectedCategories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(input => input.value);
            const selectedAreas = Array.from(document.querySelectorAll('input[name="area"]:checked')).map(input => input.value);
            const selectedIngredients = Array.from(document.querySelectorAll('input[name="ingredient"]:checked')).map(input => input.value);

            const filteredRecipes = allRecipes.filter(recipe => {
                const matchesSearch = recipe.name.toLowerCase().includes(searchQuery) ||
                    recipe.category.toLowerCase().includes(searchQuery) ||
                    recipe.ingredients.some(ingredient => ingredient.toLowerCase().includes(searchQuery));

                const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(recipe.category);
                const matchesArea = selectedAreas.length === 0 || selectedAreas.includes(recipe.area);
                const matchesIngredients = selectedIngredients.length === 0 || selectedIngredients.every(ingredient => recipe.ingredients.includes(ingredient));

                return matchesSearch && matchesCategory && matchesArea && matchesIngredients;
            });

            displayRecipes(filteredRecipes);
        }

        // Debounce search input
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', debounce(filterRecipes, 300)); // 300ms delay

        // Apply filters when the filter button is clicked
        document.getElementById('apply-filters').addEventListener('click', filterRecipes);

        // Toggle filter container visibility
        const filterToggleBtn = document.getElementById('filter-toggle');
        filterToggleBtn.addEventListener('click', function () {
            const filterContainer = document.getElementById('filter-container');
            filterContainer.style.display = filterContainer.style.display === 'none' ? 'block' : 'none';
        });
    </script>
</body>

</html>